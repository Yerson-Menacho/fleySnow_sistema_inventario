<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>{% block title %}Inventario{% endblock %}</title>

    <!-- √çconos y estilos principales -->
    <link href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    

    <!-- DataTables  -->
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" />

    <!-- Select2 -->
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />

    <!-- Estilos personalizados -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/estilos.css') }}">

    <!-- SweetAlert2 -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>
<body>

    <!-- Sidebar -->
    <nav class="sidebar">
        <header>
            <div class="image-nav">
                <span class="image">
                    <img src="{{ url_for('static', filename='img/logo.png') }}" alt="Logo">
                </span>
            </div>
            <i class="bx bx-chevron-right toggle"></i>
        </header>

        <div class="menu-bar">
            <div class="menu">
                <ul class="menu-links">
                    <li class="nav-link">
                        <a href="{{ url_for('auth.home') }}">
                            <i class='bx bx-home icon'></i>
                            <span class="text nav-text">Dashboard</span>
                        </a>
                    </li>

                    {% if tiene_permiso('usuarios.ver') %}
                    <li class="nav-link">
                        <a href="{{ url_for('usuarios.index') }}">
                            <i class="bx bx-user icon"></i>
                            <span class="text nav-text">Usuarios</span>
                        </a>
                    </li>
                    {% endif %}

                    {% if tiene_permiso('insumos.ver') %}
                    <li class="nav-link">
                        <a href="{{ url_for('insumos.index') }}">
                            <i class="bx bx-package icon"></i>
                            <span class="text nav-text">Insumos</span>
                        </a>
                    </li>
                    {% if tiene_permiso('movimientos.ver') %}
                    <li class="nav-link">
                        <a href="{{ url_for('movimientos.index') }}">
                            <i class="bx bx-transfer icon"></i>
                            <span class="text nav-text">Registrar Movimientos</span>
                        </a>
                    </li>
                    {% endif %}
                    {% endif %}

                    {% if tiene_permiso('recepcion.ver') %}
                    <li class="nav-link">
                        <a href="{{ url_for('recepcion.index') }}">
                            <i class="bx bx-clipboard icon"></i>
                            <span class="text nav-text">Recepci√≥n Materia Prima</span>
                        </a>
                    </li>
                    {% endif %}

                    

                    {% if tiene_permiso('agricultores.ver') %}
                    <li class="nav-link">
                        <a href="{{ url_for('agricultores.index') }}">
                            <i class="bx bx-leaf icon"></i>
                            <span class="text nav-text">Agricultores</span>
                        </a>
                    </li>
                    {% endif %}
                </ul>
            </div>

            <div class="botton-content">
                <ul>
                    <li class="nav-link">
                        <a href="/login">
                            <i class='bx bx-log-out icon'></i>
                            <span class="text nav-text">Cerrar sesi√≥n</span>
                        </a>
                    </li>
                    <li class="mode">
                        <div class="moon-sun">
                            <i class='bx bx-moon icon moon'></i>
                            <i class='bx bx-sun icon sun'></i>
                        </div>
                        <span class="mode-text text">Modo claro</span>
                        <div class="toggle-switch">
                            <span class="switch"></span>
                        </div>
                    </li>
                </ul> 
            </div>
        </div>
    </nav>

    <!-- Contenido principal -->
    <main class="content">
        {% block content %}{% endblock %}
    </main>

    <!-- üìå Mensajes flash -->
    {% with messages = get_flashed_messages(with_categories=true) %}
        <script id="flash-messages" type="application/json">
            {{ messages|tojson }}
        </script>
    {% endwith %}

    <!-- ========== JS ========== -->

    <!-- jQuery (siempre primero) -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <!-- Bootstrap Bundle -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <!-- DataTables + Bootstrap -->
    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>

    <!-- Select2 -->
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>

    <!-- Scripts propios -->
    <script src="{{ url_for('static', filename='JS/general.js') }}"></script>
    <script src="{{ url_for('static', filename='js/select2_config.js') }}"></script>

    {% block scripts %}{% endblock %}

<script>
document.addEventListener("DOMContentLoaded", () => {

    const body = document.body;
    const modeSwitch = document.querySelector(".toggle-switch");
    const modeText = document.querySelector(".mode-text");
    const moon = document.querySelector(".moon");
    const sun = document.querySelector(".sun");

    // ------ Estado guardado ------
    const mode = localStorage.getItem("theme");

    if (mode === "dark") {
        body.classList.add("dark");
        modeText.textContent = "Modo oscuro";
    } else {
        body.classList.remove("dark");
        modeText.textContent = "Modo claro";
    }

    // ------ Toggle ------
    modeSwitch.addEventListener("click", () => {
        body.classList.toggle("dark");

        if (body.classList.contains("dark")) {
            localStorage.setItem("theme", "dark");
            modeText.textContent = "Modo oscuro";
        } else {
            localStorage.setItem("theme", "light");
            modeText.textContent = "Modo claro";
        }
    });

});
</script>
</script>
</body>
</html>
